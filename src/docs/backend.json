
{
  "entities": {
    "user_root": {
      "title": "Racine Utilisateur",
      "description": "Un document racine qui associe l'UID d'un utilisateur à l'identifiant de son école.",
      "type": "object",
      "properties": {
        "schoolId": { "type": "string", "description": "L'identifiant de l'école à laquelle l'utilisateur appartient." }
      },
      "required": ["schoolId"]
    },
    "school": {
        "title": "École",
        "description": "Un établissement scolaire.",
        "type": "object",
        "properties": {
            "name": { "type": "string", "description": "Le nom de l'établissement." },
            "matricule": { "type": "string", "description": "Le numéro matricule de l'établissement." },
            "cnpsEmployeur": { "type": "string", "description": "Le numéro d'immatriculation CNPS de l'école." },
            "directorId": { "type": "string", "description": "L'UID du directeur de l'école." },
            "directorFirstName": { "type": "string", "description": "Le prénom du directeur de l'école." },
            "directorLastName": { "type": "string", "description": "Le nom de famille du directeur de l'école." },
            "directorPhone": { "type": "string", "description": "Le numéro de téléphone du directeur." },
            "schoolCode": { "type": "string", "description": "Un code lisible par l'homme pour rejoindre l'école." },
            "createdAt": { "type": "string", "format": "date-time", "description": "La date de création de l'école." },
            "address": { "type": "string", "description": "Adresse de l'école." },
            "phone": { "type": "string", "description": "Numéro de téléphone de l'école." },
            "website": { "type": "string", "description": "Site web de l'école." },
            "mainLogoUrl": { "type": "string", "format": "uri", "description": "URL du logo principal de l'école." },
            "email": { "type": "string", "format": "email", "description": "Email de contact de l'école." },
            "subscription": {
                "type": "object",
                "description": "Détails de l'abonnement de l'école.",
                "properties": {
                    "plan": { "type": "string", "enum": ["Essentiel", "Pro"], "description": "Le nom du plan." },
                    "status": { "type": "string", "enum": ["active", "trialing", "past_due", "canceled"], "description": "Le statut de l'abonnement." }
                }
            }
        },
        "required": ["name", "directorId", "directorFirstName", "directorLastName", "schoolCode"]
    },
     "admin_role": {
      "title": "Rôle Administrateur",
      "description": "Définit un ensemble de permissions pour un rôle administratif.",
      "type": "object",
      "properties": {
        "name": { "type": "string", "description": "Nom du rôle (ex: Super Admin, Admin École)." },
        "description": { "type": "string", "description": "Description des responsabilités du rôle." },
        "level": { "type": "number", "description": "Niveau de permission (1 = le plus élevé)." },
        "permissions": {
          "type": "object",
          "properties": {
            "manageUsers": { "type": "boolean" },
            "viewUsers": { "type": "boolean" },
            "manageSchools": { "type": "boolean" },
            "viewSchools": { "type": "boolean" },
            "manageClasses": { "type": "boolean" },
            "manageGrades": { "type": "boolean" },
            "manageSystem": { "type": "boolean" },
            "viewAnalytics": { "type": "boolean" },
            "manageSettings": { "type": "boolean" },
            "manageBilling": { "type": "boolean" },
            "manageContent": { "type": "boolean" },
            "viewSupportTickets": { "type": "boolean" },
            "manageSupportTickets": { "type": "boolean" },
            "apiAccess": { "type": "boolean" },
            "exportData": { "type": "boolean" }
          }
        }
      },
      "required": ["name", "level", "permissions"]
    },
    "staff": {
      "title": "Membre du Personnel",
      "description": "Un membre du personnel de l'école (enseignant ou non-enseignant). Représente aussi le profil utilisateur.",
      "type": "object",
      "properties": {
        "uid": { "type": "string", "description": "L'identifiant unique de l'utilisateur (Firebase Auth UID)." },
        "email": { "type": "string", "format": "email", "description": "L'adresse e-mail de l'utilisateur." },
        "displayName": { "type": "string", "description": "Le nom d'affichage de l'utilisateur." },
        "photoURL": { "type": "string", "format": "uri", "description": "L'URL de la photo de profil de l'utilisateur." },
        "schoolId": { "type": "string", "description": "L'identifiant de l'école à laquelle l'utilisateur appartient." },
        "firstName": { "type": "string", "description": "Le prénom du membre du personnel." },
        "lastName": { "type": "string", "description": "Le nom de famille du membre du personnel." },
        "role": { "type": "string", "enum": ["directeur", "enseignant", "personnel", "coordinateur"], "description": "Le rôle de l'utilisateur dans l'école." },
        "adminRole": { "type": "string", "description": "L'ID du rôle administratif si l'utilisateur est un admin." },
        "hireDate": { "type": "string", "format": "date", "description": "La date d'embauche." },
        "phone": { "type": "string", "description": "Le numéro de téléphone." },
        "matricule": { "type": "string", "description": "Matricule interne de l'employé." },
        "status": { "type": "string", "enum": ["Actif", "Inactif"], "description": "Statut de l'employé." },
        "subject": { "type": "string", "description": "La matière principale enseignée (si enseignant)." },
        "classId": { "type": "string", "description": "L'identifiant de la classe principale supervisée (si enseignant)." },
        "situationMatrimoniale": { "type": "string", "enum": ["Célibataire", "Marié(e)", "Divorcé(e)", "Veuf(ve)"], "description": "Situation matrimoniale." },
        "enfants": { "type": "number", "description": "Nombre d'enfants à charge." },
        "categorie": { "type": "string", "description": "Catégorie professionnelle." },
        "cnpsEmploye": { "type": "string", "description": "Numéro CNPS de l'employé." },
        "baseSalary": { "type": "number", "description": "Le salaire de base mensuel." },
        "indemniteTransportImposable": { "type": "number", "description": "Indemnité de transport imposable." },
        "indemniteResponsabilite": { "type": "number", "description": "Indemnité de responsabilité." },
        "indemniteLogement": { "type": "number", "description": "Indemnité de logement." },
        "indemniteSujetion": { "type": "number", "description": "Indemnité de sujétion." },
        "indemniteCommunication": { "type": "number", "description": "Indemnité de communication." },
        "indemniteRepresentation": { "type": "number", "description": "Indemnité de représentation." },
        "transportNonImposable": { "type": "number", "description": "Transport non imposable." },
        "banque": { "type": "string", "description": "Nom de la banque." },
        "numeroCompte": { "type": "string", "description": "Numéro de compte bancaire (sans code banque/guichet/clé)." },
        "CB": { "type": "string", "description": "Code Banque du RIB." },
        "CG": { "type": "string", "description": "Code Guichet du RIB." },
        "Cle_RIB": { "type": "string", "description": "Clé RIB." },
        "CNPS": { "type": "boolean", "description": "L'employé est-il soumis aux cotisations CNPS ?" }
      },
      "required": ["uid", "email", "schoolId", "role", "firstName", "lastName", "hireDate", "baseSalary"]
    },
    "student": {
        "title": "Élève",
        "description": "Un élève inscrit à l'école.",
        "type": "object",
        "properties": {
            "schoolId": { "type": "string", "description": "L'identifiant de l'école parente." },
            "matricule": { "type": "string", "description": "Le numéro matricule unique de l'élève." },
            "firstName": { "type": "string", "description": "Le prénom de l'élève." },
            "lastName": { "type": "string", "description": "Le nom de famille de l'élève." },
            "photoUrl": { "type": "string", "format": "uri", "description": "URL de la photo de profil de l'élève." },
            "status": { "type": "string", "enum": ["Actif", "En attente", "Radié"], "description": "Statut actuel de l'élève." },
            "classId": { "type": "string", "description": "L'identifiant de la classe actuelle de l'élève." },
            "class": { "type": "string", "description": "Le nom de la classe actuelle de l'élève." },
            "cycle": { "type": "string", "description": "Le nom du cycle actuel de l'élève." },
            "dateOfBirth": { "type": "string", "format": "date", "description": "La date de naissance de l'élève." },
            "placeOfBirth": { "type": "string", "description": "Le lieu de naissance de l'élève." },
            "gender": { "type": "string", "enum": ["Masculin", "Féminin"], "description": "Le sexe de l'élève." },
            "address": { "type": "string", "description": "L'adresse de l'élève." },
            "parent1FirstName": { "type": "string", "description": "Le prénom du premier parent/tuteur." },
            "parent1LastName": { "type": "string", "description": "Le nom de famille du premier parent/tuteur." },
            "parent1Contact": { "type": "string", "description": "Le contact téléphonique du premier parent/tuteur." },
            "parent2FirstName": { "type": "string", "description": "Le prénom du deuxième parent/tuteur (optionnel)." },
            "parent2LastName": { "type": "string", "description": "Le nom de famille du deuxième parent/tuteur (optionnel)." },
            "parent2Contact": { "type": "string", "description": "Le contact téléphonique du deuxième parent/tuteur (optionnel)." },
            "previousSchool": { "type": "string", "description": "L'ancienne école de l'élève (optionnel)." },
            "tuitionFee": { "type": "number", "description": "Le montant total de la scolarité pour la classe de l'élève." },
            "discountAmount": { "type": "number", "description": "Le montant de la remise ou de la bourse accordée." },
            "discountReason": { "type": "string", "description": "La raison de la remise." },
            "amountDue": { "type": "number", "description": "Le montant restant à payer." },
            "tuitionStatus": { "type": "string", "enum": ["Soldé", "En retard", "Partiel"], "description": "Le statut du paiement de la scolarité." },
            "feedback": { "type": "string", "description": "Appréciation générale sur l'élève." },
            "createdAt": { "type": "string", "format": "date-time", "description": "La date d'inscription de l'élève." }
        },
        "required": ["schoolId", "firstName", "lastName", "matricule", "status", "dateOfBirth", "placeOfBirth", "gender", "parent1FirstName", "parent1LastName", "parent1Contact", "tuitionFee", "amountDue", "tuitionStatus"]
    },
    "cycle": {
        "title": "Cycle",
        "description": "Un cycle d'enseignement (ex: Maternelle, Primaire).",
        "type": "object",
        "properties": {
            "schoolId": { "type": "string" },
            "name": { "type": "string", "description": "Nom du cycle (ex: Maternelle)." },
            "code": { "type": "string", "description": "Code du cycle (ex: MAT)." },
            "order": { "type": "number", "description": "Ordre d'affichage." },
            "description": { "type": "string" },
            "ageRange": {
                "type": "object",
                "properties": {
                    "min": { "type": "number" },
                    "max": { "type": "number" }
                }
            },
            "createdAt": { "type": "string", "format": "date-time" },
            "updatedAt": { "type": "string", "format": "date-time" },
            "color": { "type": "string" }
        },
        "required": ["schoolId", "name", "code", "order"]
    },
    "niveau": {
        "title": "Niveau",
        "description": "Un niveau scolaire au sein d'un cycle (ex: CE1, 6ème).",
        "type": "object",
        "properties": {
            "schoolId": { "type": "string" },
            "cycleId": { "type": "string" },
            "name": { "type": "string", "description": "Nom du niveau (ex: CE1)." },
            "code": { "type": "string", "description": "Code du niveau (ex: CE1)." },
            "order": { "type": "number" },
            "ageMin": { "type": "number" },
            "ageMax": { "type": "number" },
            "capacity": { "type": "number", "description": "Nombre maximum d'élèves." },
            "color": { "type": "string", "description": "Couleur pour l'interface." },
            "description": { "type": "string" },
            "createdAt": { "type": "string", "format": "date-time" },
            "updatedAt": { "type": "string", "format": "date-time" }
        },
        "required": ["schoolId", "cycleId", "name", "code", "order", "ageMin", "ageMax", "capacity"]
    },
    "classe": {
      "title": "Classe",
      "description": "Une classe spécifique pour une année académique (ex: CE1-A 2024-2025).",
      "type": "object",
      "properties": {
        "schoolId": { "type": "string" },
        "cycleId": { "type": "string" },
        "niveauId": { "type": "string" },
        "name": { "type": "string", "description": "Nom complet (ex: CE1-A)." },
        "grade": { "type": "string", "description": "Nom du niveau, ex: 'CE1'." },
        "code": { "type": "string", "description": "Code unique (ex: CE1A)." },
        "section": { "type": "string", "description": "Section (A, B, C...)." },
        "academicYear": { "type": "string", "description": "Année académique (ex: 2024-2025)." },
        "studentCount": { "type": "number" },
        "maxStudents": { "type": "number" },
        "mainTeacherId": { "type": "string" },
        "mainTeacherName": { "type": "string" },
        "teacherIds": { "type": "array", "items": { "type": "string" } },
        "coordinatorId": { "type": "string" },
        "schedule": {
          "type": "object",
          "properties": {
            "startTime": { "type": "string" },
            "endTime": { "type": "string" },
            "days": { "type": "array", "items": { "type": "string" } }
          }
        },
        "classroom": { "type": "string" },
        "building": { "type": "string" },
        "status": { "type": "string", "enum": ["active", "inactive", "archived"] },
        "isFull": { "type": "boolean" },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" },
        "createdBy": { "type": "string" }
      },
      "required": ["schoolId", "cycleId", "niveauId", "name", "code", "academicYear", "studentCount", "maxStudents", "status", "isFull", "createdBy"]
    },
    "studentClassAssignment": {
        "title": "Affectation Élève-Classe",
        "description": "Historique de l'affectation d'un élève à une classe pour une année.",
        "type": "object",
        "properties": {
            "schoolId": { "type": "string" },
            "studentId": { "type": "string" },
            "classeId": { "type": "string" },
            "academicYear": { "type": "string" },
            "startDate": { "type": "string", "format": "date-time" },
            "endDate": { "type": "string", "format": "date-time" },
            "previousClass": { "type": "string" },
            "promotionType": { "type": "string", "enum": ["normal", "redoublement", "avancement"] },
            "notes": { "type": "string" },
            "status": { "type": "string", "enum": ["active", "transferred", "graduated", "withdrawn"] },
            "createdAt": { "type": "string", "format": "date-time" },
            "createdBy": { "type": "string" }
        },
        "required": ["schoolId", "studentId", "classeId", "academicYear", "startDate", "promotionType", "status", "createdBy"]
    },
    "timetableEntry": {
        "title": "Entrée d'Emploi du Temps",
        "description": "Un cours spécifique dans l'emploi du temps d'une classe.",
        "type": "object",
        "properties": {
            "schoolId": { "type": "string" },
            "classId": { "type": "string" },
            "teacherId": { "type": "string" },
            "subject": { "type": "string" },
            "day": { "type": "string", "enum": ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"] },
            "startTime": { "type": "string", "description": "Format HH:mm" },
            "endTime": { "type": "string", "description": "Format HH:mm" },
            "classroom": { "type": "string" },
            "color": { "type": "string", "description": "Couleur pour l'affichage" }
        },
        "required": ["schoolId", "classId", "teacherId", "subject", "day", "startTime", "endTime"]
    },
    "gradeEntry": {
        "title": "Note",
        "description": "Une note individuelle pour un élève dans une matière.",
        "type": "object",
        "properties": {
            "subject": { "type": "string", "description": "La matière concernée." },
            "type": { "type": "string", "enum": ["Interrogation", "Devoir"], "description": "Le type d'évaluation." },
            "date": { "type": "string", "format": "date", "description": "La date de l'évaluation." },
            "grade": { "type": "number", "description": "La note obtenue." },
            "coefficient": { "type": "number", "description": "Le coefficient de la note." }
        },
        "required": ["subject", "type", "date", "grade", "coefficient"]
    },
    "accountingTransaction": {
      "title": "Transaction Comptable",
      "description": "Une transaction financière (revenu ou dépense).",
      "type": "object",
      "properties": {
        "schoolId": { "type": "string", "description": "L'identifiant de l'école parente." },
        "date": { "type": "string", "format": "date", "description": "La date de la transaction." },
        "description": { "type": "string", "description": "La description de la transaction." },
        "category": { "type": "string", "description": "La catégorie de la transaction." },
        "type": { "type": "string", "enum": ["Revenu", "Dépense"], "description": "Le type de transaction." },
        "amount": { "type": "number", "description": "Le montant de la transaction." }
      },
      "required": ["schoolId", "date", "description", "category", "type", "amount"]
    },
    "payment": {
      "title": "Paiement de scolarité",
      "description": "Un versement de frais de scolarité pour un élève.",
      "type": "object",
      "properties": {
        "date": { "type": "string", "format": "date", "description": "La date du paiement." },
        "amount": { "type": "number", "description": "Le montant payé." },
        "description": { "type": "string", "description": "Description du paiement (ex: 1ère tranche)." },
        "accountingTransactionId": { "type": "string", "description": "L'ID de la transaction comptable correspondante." },
        "payerFirstName": { "type": "string", "description": "Le prénom de la personne qui a effectué le paiement." },
        "payerLastName": { "type": "string", "description": "Le nom de la personne qui a effectué le paiement." },
        "payerContact": { "type": "string", "description": "Le contact de la personne qui a effectué le paiement." },
        "method": { "type": "string", "enum": ["Espèces", "Chèque", "Virement Bancaire", "Paiement Mobile"], "description": "Le mode de paiement utilisé." }
      },
      "required": ["date", "amount", "description", "accountingTransactionId", "payerFirstName", "payerLastName", "method"]
    },
    "libraryBook": {
        "title": "Livre de Bibliothèque",
        "description": "Un livre disponible dans la bibliothèque de l'école.",
        "type": "object",
        "properties": {
            "schoolId": { "type": "string", "description": "L'identifiant de l'école parente." },
            "title": { "type": "string", "description": "Le titre du livre." },
            "author": { "type": "string", "description": "L'auteur du livre." },
            "quantity": { "type": "number", "description": "Le nombre d'exemplaires disponibles." },
            "createdAt": { "type": "string", "format": "date-time", "description": "La date d'ajout du livre." }
        },
        "required": ["schoolId", "title", "author", "quantity"]
    },
    "message": {
        "title": "Message",
        "description": "Un message ou une annonce envoyé(e) via la messagerie interne.",
        "type": "object",
        "properties": {
            "schoolId": { "type": "string", "description": "L'identifiant de l'école parente." },
            "title": { "type": "string", "description": "Le titre ou l'objet du message." },
            "content": { "type": "string", "description": "Le corps du message." },
            "senderId": { "type": "string", "description": "L'UID de l'expéditeur." },
            "senderName": { "type": "string", "description": "Le nom de l'expéditeur." },
            "createdAt": { "type": "string", "format": "date-time", "description": "La date d'envoi du message." },
            "recipients": {
                "type": "object",
                "description": "Définit les destinataires du message.",
                "properties": {
                    "all": { "type": "boolean", "description": "Envoyer à toute l'école (parents, enseignants, personnel)." },
                    "teachers": { "type": "boolean", "description": "Envoyer à tous les enseignants." },
                    "staff": { "type": "boolean", "description": "Envoyer à tout le personnel non-enseignant." },
                    "classes": {
                        "type": "array",
                        "items": { "type": "string" },
                        "description": "Une liste d'IDs de classes spécifiques à cibler."
                    }
                }
            }
        },
        "required": ["schoolId", "title", "content", "senderId", "senderName", "createdAt", "recipients"]
    },
    "absence": {
        "title": "Absence",
        "description": "Une absence enregistrée pour un élève.",
        "type": "object",
        "properties": {
            "schoolId": { "type": "string", "description": "L'identifiant de l'école parente." },
            "studentId": { "type": "string", "description": "L'identifiant de l'élève absent." },
            "studentName": { "type": "string", "description": "Le nom complet de l'élève." },
            "classId": { "type": "string", "description": "L'identifiant de la classe de l'élève." },
            "date": { "type": "string", "format": "date", "description": "La date de l'absence." },
            "type": { "type": "string", "enum": ["Journée entière", "Matin", "Après-midi"], "description": "Le type d'absence." },
            "justified": { "type": "boolean", "description": "Indique si l'absence est justifiée." },
            "reason": { "type": "string", "description": "Le motif de l'absence (si justifiée)." },
            "recordedBy": { "type": "string", "description": "L'UID de l'utilisateur qui a enregistré l'absence." }
        },
        "required": ["schoolId", "studentId", "studentName", "classId", "date", "type", "justified", "recordedBy"]
    },
    "fee": {
        "title": "Frais de Scolarité",
        "description": "Une structure de frais de scolarité.",
        "type": "object",
        "properties": {
            "schoolId": { "type": "string", "description": "L'identifiant de l'école parente." },
            "grade": { "type": "string", "description": "Le niveau scolaire concerné par les frais." },
            "amount": { "type": "string", "description": "Le montant total des frais." },
            "details": { "type": "string", "description": "Détails supplémentaires sur les frais." },
            "installments": { "type": "string", "description": "Options de paiement en plusieurs fois." }
        },
        "required": ["schoolId", "grade", "amount", "installments"]
    },
    "subject": {
        "title": "Matière",
        "description": "Une matière enseignée dans l'école.",
        "type": "object",
        "properties": {
            "schoolId": { "type": "string" },
            "name": { "type": "string" },
            "code": { "type": "string" },
            "color": { "type": "string" }
        },
        "required": ["schoolId", "name"]
    }
  },
  "auth": {
    "providers": ["Google", "Email"]
  },
  "firestore": {
    "/utilisateurs/{userId}": {
        "schema": { "$ref": "#/entities/user_root" },
        "description": "Stocke une correspondance entre l'UID d'un utilisateur et son schoolId pour les vérifications de permissions."
    },
    "/ecoles/{schoolId}": {
      "schema": { "$ref": "#/entities/school" },
      "description": "Stocke les informations générales sur un établissement.",
      "subcollections": {
        "personnel": {
          "path": "personnel/{staffId}",
          "schema": { "$ref": "#/entities/staff" },
          "description": "Stocke les profils du personnel pour cette école."
        },
        "eleves": {
            "path": "eleves/{studentId}",
            "schema": { "$ref": "#/entities/student" },
            "description": "Stocke les profils des élèves pour cette école.",
            "subcollections": {
                "notes": {
                    "path": "notes/{gradeId}",
                    "schema": { "$ref": "#/entities/gradeEntry" },
                    "description": "Stocke les notes individuelles d'un élève."
                },
                "paiements": {
                    "path": "paiements/{paymentId}",
                    "schema": { "$ref": "#/entities/payment" },
                    "description": "Stocke l'historique des paiements de scolarité pour un élève."
                },
                "affectations": {
                    "path": "affectations/{assignmentId}",
                    "schema": { "$ref": "#/entities/studentClassAssignment" },
                    "description": "Stocke l'historique des affectations de classe pour un élève."
                }
            }
        },
        "cycles": {
            "path": "cycles/{cycleId}",
            "schema": { "$ref": "#/entities/cycle" },
            "description": "Stocke la liste des cycles d'enseignement pour cette école."
        },
        "niveaux": {
            "path": "niveaux/{niveauId}",
            "schema": { "$ref": "#/entities/niveau" },
            "description": "Stocke la liste des niveaux scolaires pour cette école."
        },
        "classes": {
            "path": "classes/{classeId}",
            "schema": { "$ref": "#/entities/classe" },
            "description": "Stocke les informations des classes pour cette école."
        },
        "emploi_du_temps": {
            "path": "emploi_du_temps/{entryId}",
            "schema": { "$ref": "#/entities/timetableEntry" },
            "description": "Stocke les entrées de l'emploi du temps pour cette école."
        },
        "frais_scolarite": {
            "path": "frais_scolarite/{feeId}",
            "schema": { "$ref": "#/entities/fee" },
            "description": "Stocke la structure des frais de scolarité pour cette école."
        },
        "absences": {
            "path": "absences/{absenceId}",
            "schema": { "$ref": "#/entities/absence" },
            "description": "Stocke l'historique des absences pour cette école."
        },
        "comptabilite": {
            "path": "comptabilite/{transactionId}",
            "schema": { "$ref": "#/entities/accountingTransaction" },
            "description": "Stocke les transactions comptables pour cette école."
        },
        "bibliotheque": {
            "path": "bibliotheque/{bookId}",
            "schema": { "$ref": "#/entities/libraryBook" },
            "description": "Stocke les livres de la bibliothèque pour cette école."
        },
        "messagerie": {
            "path": "messagerie/{messageId}",
            "schema": { "$ref": "#/entities/message" },
            "description": "Stocke les messages et annonces envoyés via la messagerie interne pour cette école."
        },
        "matieres": {
            "path": "matieres/{subjectId}",
            "schema": { "$ref": "#/entities/subject" },
            "description": "Stocke les matières enseignées dans l'école."
        }
      }
    },
    "/admin_roles/{roleId}": {
        "schema": { "$ref": "#/entities/admin_role" },
        "description": "Définit les permissions pour les rôles administratifs."
    }
  }
}
