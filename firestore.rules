rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // RÈGLES TEMPORAIRES POUR LE DÉVELOPPEMENT
    
    // Règle pour autoriser l'accès aux collections racines
    // et, plus important encore, aux sous-collections des écoles.
    match /{path=**}/documents/{document} {
      allow read, write: if request.auth != null;
    }

    // Cette règle plus spécifique garantit que l'accès aux sous-collections
    // d'une école est bien autorisé pour tout utilisateur authentifié.
    match /ecoles/{schoolId}/{document=**} {
        allow read, write: if request.auth != null;
    }

    // Exception : la création de demandes de contact est publique
    match /contact_requests/{requestId} {
      allow create: if true;
      allow read, write: if request.auth != null;
    }
    
    // Exception : la création de réponses aux enquêtes est publique
    match /survey_responses/{responseId} {
      allow create: if true;
      allow read, write: if request.auth != null;
    }
  }
}
